# PDF Export Fix - Testing Guide

## Quick Test Checklist

### Prerequisites
- [ ] Backend is running (`npm run start:dev` in backend folder)
- [ ] Frontend is running (`npm run dev` in frontend folder)
- [ ] Database has AOG event data (run seed script if needed)
- [ ] Logged in as admin/editor user

### Test 1: Full Data Export (Happy Path)

1. Navigate to AOG Analytics page: `http://localhost:5173/aog/analytics`
2. Wait for all charts to load (should see data in all sections)
3. Verify you see:
   - Summary cards with numbers
   - Three-bucket breakdown chart
   - Trend charts with lines
   - Aircraft performance heatmap
   - Cost analysis charts
   - Predictive analytics
4. Click "Export PDF" button (top right)
5. Wait for progress indicator (should show 0% → 100%)
6. PDF should download automatically

**Expected Result**: 
- PDF file named `aog-analytics-2026-02-04.pdf`
- 9 pages total:
  - Page 1: Cover page
  - Page 2: Executive Summary
  - Pages 3-9: Chart sections with visible charts

**Pass Criteria**: All charts are visible and not empty ✅

---

### Test 2: Filtered Data Export

1. On AOG Analytics page, apply filters:
   - Date Range: "Last 30 Days"
   - Fleet Group: "A340"
2. Wait for charts to update
3. Click "Export PDF"
4. Verify PDF reflects filtered data

**Expected Result**: 
- PDF shows "Period: [date range]" on cover page
- PDF shows "Filters: A340, All Aircraft" on cover page
- Charts show only A340 data from last 30 days

**Pass Criteria**: Filters are applied correctly ✅

---

### Test 3: No Data Scenario

1. Apply filters that result in no events:
   - Date Range: Custom (future dates)
   - Or: Select aircraft with no AOG events
2. Try to export PDF
3. Should see error message

**Expected Result**: 
- Error message: "No data available to export. Please adjust your filters or date range."
- No PDF is generated
- Error message has retry button

**Pass Criteria**: Graceful error handling ✅

---

### Test 4: Export During Loading

1. Clear browser cache (Ctrl+Shift+Delete)
2. Navigate to AOG Analytics page
3. Immediately click "Export PDF" while charts are still loading
4. Export should wait for data to load

**Expected Result**: 
- Export button shows "Exporting... 5%" (initial delay)
- Progress increases as sections are captured
- PDF is generated after all data loads

**Pass Criteria**: Export waits for data ✅

---

### Test 5: Multiple Exports

1. Export PDF once (Test 1)
2. Change filters
3. Export PDF again
4. Repeat 3-4 times

**Expected Result**: 
- Each export generates a new PDF
- No memory leaks or performance degradation
- Each PDF reflects current filters

**Pass Criteria**: Consistent behavior ✅

---

## Visual Verification Checklist

Open the generated PDF and verify each page:

### Page 1: Cover Page
- [ ] Title: "AOG Analytics Report"
- [ ] Subtitle: "Alpha Star Aviation"
- [ ] Period: Correct date range
- [ ] Generated timestamp
- [ ] Filters (if applied)
- [ ] Footer: "Alpha Star Aviation KPI Dashboard"

### Page 2: Executive Summary
- [ ] "Key Metrics:" section with 4-5 bullet points
- [ ] Total Events number
- [ ] Active AOG number
- [ ] Total Downtime hours
- [ ] Average Downtime hours
- [ ] Total Cost (if available)
- [ ] "Top Insights:" section with insights list

### Page 3: Three-Bucket Analysis
- [ ] Section title: "Three-Bucket Analysis"
- [ ] Bucket breakdown chart (bar/pie chart visible)
- [ ] Bucket trend chart (stacked area chart)
- [ ] Waterfall chart
- [ ] Per-aircraft breakdown table

### Page 4: Trend Analysis
- [ ] Section title: "Trend Analysis"
- [ ] Monthly trend chart (bars + line)
- [ ] 3-month moving average chart
- [ ] Year-over-year comparison chart

### Page 5: Aircraft Performance
- [ ] Section title: "Aircraft Performance"
- [ ] Aircraft heatmap (grid with colors)
- [ ] Reliability score cards (top 5 reliable + needs attention)

### Page 6: Root Cause Analysis
- [ ] Section title: "Root Cause Analysis"
- [ ] Pareto chart (bars + line)
- [ ] Category breakdown pie chart
- [ ] Responsibility distribution chart

### Page 7: Cost Analysis
- [ ] Section title: "Cost Analysis"
- [ ] Cost breakdown chart (stacked bars)
- [ ] Cost efficiency metrics cards

### Page 8: Predictive Analytics
- [ ] Section title: "Predictive Analytics"
- [ ] Forecast chart (line with confidence interval)
- [ ] Risk score gauges
- [ ] Insights panel

### Page 9: (If content overflows)
- [ ] Continuation of previous section
- [ ] Page numbers correct

### All Pages
- [ ] Page numbers: "Page X of Y" (center bottom)
- [ ] Confidentiality notice: "Confidential - Alpha Star Aviation" (left bottom)
- [ ] Generation info: "Generated by AOG Analytics System" (right bottom)

---

## Performance Benchmarks

Record export times for different scenarios:

| Scenario | Events Count | Export Time | PDF Size | Status |
|----------|--------------|-------------|----------|--------|
| Full data (all time) | ~11 | ~15-20s | ~2-3 MB | ✅ |
| Last 30 days | ~5 | ~12-15s | ~1-2 MB | ✅ |
| Single aircraft | ~2 | ~10-12s | ~1 MB | ✅ |
| No data | 0 | <1s (error) | N/A | ✅ |

---

## Browser Compatibility

Test in different browsers:

- [ ] Chrome (latest)
- [ ] Edge (latest)
- [ ] Firefox (latest)
- [ ] Safari (if available)

**Note**: Safari may require CORS configuration for external images.

---

## Known Issues & Workarounds

### Issue: Charts appear blurry in PDF
**Workaround**: This is expected due to scale=2 setting. Increase to scale=3 for higher resolution (but slower export).

### Issue: Dark mode colors in PDF
**Workaround**: PDF always uses light mode. Ensure charts use explicit colors, not CSS variables.

### Issue: Export button disabled
**Workaround**: Wait for all data to load. If stuck, refresh page.

---

## Debugging Tips

### Enable Console Logging

Open browser DevTools (F12) and check console for:
- `Section ${sectionId} not found, skipping` - Section missing from DOM
- `Failed to capture ${sectionId}, canvas is empty` - Chart not rendered
- `Timeout waiting for charts to render` - Data loading too slow

### Check Network Tab

Verify API calls are successful:
- `/api/aog-events/analytics/buckets` - Three-bucket data
- `/api/aog-events/analytics/monthly-trend` - Trend data
- `/api/aog-events/analytics/forecast` - Predictive data
- `/api/aog-events/analytics/insights` - Insights data

### Inspect Elements

Before exporting, inspect chart sections:
- Right-click on chart → Inspect
- Verify `<svg>` or `<canvas>` elements exist
- Check for loading skeletons or empty states

---

## Success Criteria

✅ **All tests pass**
✅ **PDF contains all 9 pages with visible charts**
✅ **Export completes in <30 seconds**
✅ **No console errors**
✅ **PDF file size is reasonable (<5 MB)**

---

## Rollback Procedure

If tests fail:

1. Check git log: `git log --oneline -5`
2. Identify commit before fix: `git show <commit-hash>`
3. Revert changes: `git revert <commit-hash>`
4. Rebuild frontend: `cd frontend && npm run build`
5. Redeploy

---

## Sign-Off

- [ ] All tests passed
- [ ] Visual verification complete
- [ ] Performance acceptable
- [ ] No regressions found
- [ ] Ready for production deployment

**Tested By**: _________________
**Date**: _________________
**Signature**: _________________
